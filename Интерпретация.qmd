---
title: "Анализ клинических данных"
author: "Лысова С., Мингалёв Г., Пашинцев Г., Флоренская Л."
execute:
  eval: false
---

## Постановка задачи

На основе клинического описания и данных полного геномного секвенирования (WGS) предположить генетическую причину состояния пробанда(ов), уточнить/пересмотреть диагноз и подготовить короткую презентацию из нескольких слайдов с ходом рассуждений и описанием выявленного(ых) варианта(ов).

## План работы

### Анализ фенотипа пробанда
- Выделение ключевых клинических признаков (неврологические, соматические, особенности роста и развития, семейный/репродуктивный анамнез).

### Формулировка гипотез о генетической природе заболевания
- Создание рабочих гипотез: возможный тип наследования, круг генов-кандидатов / синдромов.
- Обоснование выбора спектра диагнозов/генов на основе фенотипа и семейного анамнеза.

### Анализ данных WGS для уточнения диагноза
- Анализ VCF-файлов семьи.
- Выбор варианта(ов), потенциально объясняющих фенотип пробанда.
- Указание гена, типа варианта, модели наследования, предполагаемого механизма (LoF, missense, splice и т.д.).
- Сопоставление найденного варианта с литературными и базами данных (OMIM, ClinVar и др.).

### Формулировка итогового заключения
[В нем не стоит рекомендовать человеку процедуры или обследования - это делает врач, с которым вы вместе ведете пациента.]{.mark}

### Подготовка презентации
- **Слайд 1:** Краткое описание клинического случая (пробанд, основные симптомы, семейный/репродуктивный анамнез).
- **Слайд 2:** Диагностические гипотезы и ход рассуждений (обоснование выбора гена/синдрома, тип наследования).
- **Слайд 3:** Найденный вариант(ы): ген, тип, zygosity, модель наследования, аргументы «за» его причинную роль.
- **Слайд 4 (опционально):** Итоговое заключение, уточнённый диагноз, генетические риски для семьи, открытые вопросы.

## Диагностические гипотезы (на основе фенотипа)

Рассматриваются следующие возможные типы наследования:

1. **De novo доминантная мутация** — вероятна при здоровых родителях и сибсах. [Потребует подтверждения по Сэнгеру.]{.mark}
2. **Аутосомно-рецессивное наследование** — оба родителя являются здоровыми носителями
3. **X-сцепленное рецессивное наследование** — мать как возможная носительница, пробанд мужского пола.

## Стратегия анализа данных WGS и реализация на Python

### Инициализация и загрузка данных

```{python}

import pandas as pd
import numpy as np

# Загружаем данные WGS из VCF-файла, сконвертированного в табличный формат
df = pd.read_csv('/home/florenskayalk/64family.txt', sep='\t', usecols=[
    '#[1]CHROM', '[2]POS', '[3]ID', '[8]SYMBOL', '[15]Consequence',
    '[21]AF_joint', '[29]CLNSIG', '[31]CLNDN', '[35]CADD_PHRED',
    '[43]000028002000:GT', '[46]000028003810:GT', '[49]000028001980:GT', '[52]000028001990:GT'
])
print(f"Всего вариантов: {len(df)}")
```

### Подготовка данных CADD и AF

```{python}

def parse(cadd_str):
    try:
        if pd.isna(cadd_str):
            return None
        return float(str(cadd_str).replace(',', '.').strip())
    except:
        return None

df['CADD_num'] = df['[35]CADD_PHRED'].apply(parse)
df['[21]AF_joint'] = df['[21]AF_joint'].apply(parse)
```

### Первичный отбор вариантов
- Исключение референсных генотипов у пробанда.
- Фильтрация по частоте в популяции (AF < 1%).
- Отбор функционально значимых вариантов ~~(исключение синонимичных и интронных)~~ [нельзя исключать интронные варианты!]{.mark}

```{python}

# Только варианты у пробанда (не референсные)
proband_gt = df['[43]000028002000:GT']
df = df[~proband_gt.isin(['0/0', './.', '0|0', '.|.'])]

# Исключаем частые популяционные варианты (порог можно менять)
df = df[pd.to_numeric(df['[21]AF_joint'], errors='coerce').fillna(0) < 0.01]


print(f"Вариантов после базовой фильтрации: {len(df)}")
```

### Поиск de novo мутаций
- Приоритетный анализ.
- Критерии: вариант присутствует у пробанда, отсутствует у обоих родителей и здоровго сибса.


```{python}
def is_de_novo(row):
    proband = row['[43]000028002000:GT']
    mother = row['[49]000028001980:GT']
    father = row['[52]000028001990:GT']
    sibs = row['[46]000028003810:GT']
    # У пробанда есть вариант, у родителей оба аллеля референсные
    if proband not in ['0/0', './.', '0|0', '.|.']:
        if mother in ['0/0', '0|0'] and father in ['0/0', '0|0'] and sibs in ['0/0', '0|0']:
            return 'YES'
    return 'NO'

df['de_novo'] = df.apply(is_de_novo, axis=1)
df_de_novo = df[df['de_novo'] == 'YES'].copy()
print(f"Кандидатов de novo: {len(df_de_novo)}")

```

### Анализ X-сцепленных вариантов
- Поиск гемизиготных вариантов у пробанда (мужского пола).
- Проверка статуса носительства у матери (гетерозигота).

```{python}
df_x = df[df['#[1]CHROM'] == 'chrX'].copy()
if not df_x.empty:
    print(f"\nВариантов на X-хромосоме: {len(df_x)}")
    # Ищем гемизиготные у пробанда и гетерозиготные у матери
    x_linked_candidates = df_x[
        (df_x['[43]000028002000:GT'].isin(['1', '1/1', '1|1'])) &  # Гемизигота у мальчика
        (df_x['[49]000028001980:GT'].isin(['0/1', '0|1', '1/0', '1|0']))  # Гетерозигота у матери
    ]
    print(f"Кандидатов X-сцепленных (у пробанда гемизигота, у матери носительство): {len(x_linked_candidates)}")
```

### Выявление аутосомно-рецессивных вариантов
- Поиск компаунд-гетерозигот или гомозигот.
- Критерии: наличие ≥2 нереференсных вариантов в одном гене с CADD > 20.

```{python}
# Сначала найдем все гены, где у пробанда >=2 нереференсных варианта
mask_multiple_in_gene = df.duplicated(subset='[8]SYMBOL', keep=False)
df_multiple = df[mask_multiple_in_gene].copy()

if not df_multiple.empty:
    # Для каждого гена смотрим генотипы в семье
    recessive_candidates = []
    for gene, gene_df in df_multiple.groupby('[8]SYMBOL'):
        # У пробанда в этом гене два разных патогенных варианта?
        # Простая эвристика: есть хотя бы два варианта с CADD > 20
        hi_vars = gene_df[gene_df['CADD_num'] > 20]
        if len(hi_vars) >= 2:
            recessive_candidates.append(gene)
    
    print(f"\nГены-кандидаты для рецессивного наследования (>=2 варианта с CADD>20): {recessive_candidates}")
```



### Прицельный поиск по генам-кандидатам
- Ручная проверка ключевых генов, связанных с клиническим фенотипом (например, гены RASопатий, ихтиоза, неврологических нарушений).

```{python}
# Составим список генов, связанных с фенотипом
candidate_genes = ['NF1', 'BRAF', 'KRAS', 'HRAS', 'NRAS', 'MAP2K1', 'MAP2K2',  # RASопатии
                   'FLG', 'KRT1', 'KRT10', 'ALOX12B', 'ALOXE3', 'TGM1',  # Ихтиоз
                   'MECP2', 'CDKL5', 'SYNGAP1', 'SCN1A', 'SCN2A',  # Неврологические
                   'PTEN'  # Схожие черты
                  ]

print(f"\n--- Поиск по известным генам-кандидатам ({len(candidate_genes)} генов) ---")
df_candidate = df[df['[8]SYMBOL'].isin(candidate_genes)].copy()
if not df_candidate.empty:
    print("Найдены варианты в генах-кандидатах")
else:
    print("В известных генах-кандидатах вариантов не найдено.")

```

