---
engine: knitr
author: "Анна Сергеевна Попенко, к.б.н."
---

# Аннотация геномов

## Введение

Все ранее изученные компоненты курса (базы данных, алгоритмы, утилиты) являются составными частями единого комплексного процесса — аннотации геномов.

## Аннотация геномов

Это систематическое описание всех элементов генома, включающее два основных уровня:

1.  **Структурная аннотация** — разметка элементов генома:
    -   Кодирующие и некодирующие участки
    -   Регуляторные элементы (промоторы, сайты связывания транскрипционных факторов)
    -   Вставки вирусов
    -   CRISPR-области
2.  **Функциональная аннотация** — определение биологической роли структурных элементов (преимущественно для кодирующих генов) путем сравнения с известными последовательностями в базах данных.

**Типичный пайплайн анализа генома:**

```{mermaid}
%%| fig-align: center
%%| caption: |
%%|   Стандартный workflow анализа данных секвенирования генома.  
%%|   Каждый этап включает специфичные инструменты и проверки качества.


flowchart TD
    A["**Сырые риды**<br>FASTQ файлы<br>Illumina/ONT/PacBio"] --> B
    
    subgraph B [**QC ридов**]
        direction LR
        B1["FastQC<br>MultiQC"] --> B2["Trimmomatic, Fastp<br>Cutadapt"]
        B2 --> B3["Чистые риды"]
    end
    
    B --> C
    
    subgraph C [**Сборка контигов**]
        direction LR
        C1["Ассемблеры<br>SPAdes, MEGAHIT, Flye"] --> C2["Контиги<br>FASTA файл"]
    end
    
    C --> D
    
    subgraph D [**QC сборки**]
        direction LR
        D1["QUAST<br>IGV"] --> D2["Оценка N50, полноты,<br>загрязнения"]
    end
    
    
    D --> E
    
    subgraph E [**Аннотация**]
        direction TB
        subgraph E1[Компоненты аннотации]
        direction LR
        E0["**Структурная**<br>Prodigal, Augustus<br>HMMER<br>GeneMark"] 
        
        E2_Functional["**Функциональная**<br>BLAST, MMseqs2, KEGG, COG, GO"]

       E3_Specialized["**Специализированные БД**<br>VFDB,CARD<br>Abricate, RGI, PlasmidFinder"]
        

        end

        E0 --> E4["**Комплексные пайплайны**<br>Prokka, Bakta, PGAP<br>MAKER, BRAKER"]
        E2_Functional --> E4
        E3_Specialized --> E4
    end
    
    E --> F
    
    subgraph F [**Биологическая интерпретация**]
        
    end

    style A fill:#ffcccc
    style B fill:#cce5ff
    style C fill:#d4edda
    style D fill:#fff3cd
    style E fill:#e2d3f3
    style F fill:#f8d7da
    

    style E0 fill:#ffebcc
    style E1 fill:#e6f7ff
    style E2_Functional fill:#ffe6e6
    style E3_Specialized fill:#f0e6ff
    style E4 fill:#d4edda

```

## Структурная аннотация: элементы генома

### Прокариотический геном

Компактный, кольцевая ДНК, совмещение транскрипции и трансляции:

1.  **CDS (Coding Sequences)** — кодирующие последовательности, часто организованы в опероны.
2.  **рРНК (рибосомальные РНК):** 5S, 16S, 23S. Используются для таксономической классификации благодаря наличию консервативных и вариабельных участков.
3.  **тРНК (транспортные РНК)** — присутствие полного набора является критерием качества аннотации.
4.  **Регуляторные элементы:** промоторы, последовательность Шайна-Дальгарно.
5.  **нкРНК (некодирующие РНК):** малые регуляторные РНК, CRISPR-последовательности.
6.  **Повторяющиеся элементы:** транспозоны.
7.  **Элементы репликации:** ориджины, DnaA-боксы.
8.  **Нетранслируемые регионы (UTR):** 5' и 3' UTR.

### Эукариотический геном

Сложная организация, разделение транскрипции и трансляции:

1.  **Гены со сложной структурой:** экзоны, интроны, альтернативный сплайсинг. Часто требует данных транскриптомики для точной разметки.
2.  **UTR-регионы:** 5' и 3' UTR.
3.  **Псевдогены** (редки у прокариот) — последовательности, похожие на гены, но утратившие функцию.
4.  **Регуляторные элементы:** энхансеры, сайленсеры, промоторы.
5.  **нкРНК:** большее разнообразие (miRNA, lncRNA, snoRNA, snRNA).
6.  **Элементы хроматиновой структуры:** TAD-домены (топологически ассоциированные домены). Позволяет предсказывать упаковку ДНК.

## Алгоритмы структурной аннотации

### 1. Методы *ab initio* (предсказание на основе статистических свойств)

Используют отличительные признаки генов: состав кодонов, GC-состав, частоты олигонуклеотидов. Основаны на скрытых марковских моделях (HMM).

-   **Prodigal** — для прокариот.
-   **Augustus** — для эукариот (учитывает экзон-интронную структуру).
-   **GeneMark** — универсальный инструмент.

### 2. Гомологические (сравнительные) методы

Поиск схожих последовательностей в базах данных для переноса аннотации.

-   **BLAST, MMseqs2** — поиск гомологов.
-   **HMMER** — чувствительный поиск белковых доменов.
-   **Exonerate** — точное выравнивание известного гена на геном.

**Применение:** Гомологические методы часто используются *после* *ab initio* для функциональной аннотации, так как самостоятельно могут плохо отличать функциональные гены от псевдогенов.

## Функциональная аннотация

Основная идея: сравнение предсказанных генов/белков с известными последовательностями и их функциями.

**Основные подходы:** 

1. **Гомологический поиск** (BLASTp, BLASTn, BLASTx). 2. **Аннотация доменов** (HMMER → базы доменов: Pfam, TIGRFAMs, CDD). 3. **Интеграция аннотаций** из специализированных баз данных (eggNOG, KEGG KO, InterPro, COG, GO, Reactome).

## Базы данных для аннотации

| Категория баз данных | Примеры | Назначение |
|:-----------------------|:-----------------------|:-----------------------|
| **Универсальные** (аннотированные последовательности) | UniProtKB (Swiss-Prot, TrEMBL), GenBank, RefSeq (NCBI) | Хранение и поиск аннотированных генов и геномов |
| **БД ортологов / функциональных групп** | GO (Gene Ontology), eggNOG, OrthoDB (NCBI) | Группировка генов/белков по эволюционному родству или функции |
| **БД доменов и семейств белков** | Pfam, TIGRFAMs, CDD, SMART, PANTHER | Аннотация консервативных мотивов и доменов |
| **БД метаболических путей и реакций** | KEGG, MetaCyc, Reactome | Сборка генов в функциональные сети и пути |

## Специализированная аннотация (для бактерий)

При анализе клинически значимых изолятов часто требуется дополнительная информация: 

* **Факторы вирулентности:** VFDB. 
* ***Гены устойчивости к антибиотикам:** CARD. 
* **Плазмиды:** PlasmidFinder. 
* **CRISPR-системы:** CRISPRCasFinder.

## Уровни доказательности аннотации (по убыванию надежности)

1.  Экспериментальное подтверждение (например, записи в Swiss-Prot)
2.  Наличие высококонсервативного белкового домена.
3.  Высокий уровень гомологии с аннотированным ортологом.
4.  Присутствие большинства генов известного метаболического пути (аннотация пути в целом надежнее, чем отдельного гена).

## Инструменты комплексной аннотации геномов

Пайплайны, принимающие на вход собранный геном (FASTA) и выдающие таблицу аннотаций.

| Инструмент | Тип генома | Основной метод | Сильные стороны | Ограничения | Применение |
|:-----------|:-----------|:-----------|:-----------|:-----------|:-----------|
| **Prokka** | Прокариоты | BLAST + HMMER + Prodigal | Быстрый, простой, устойчивый | Поверхностная функц. аннотация, устаревшие БД | Быстрая черновая аннотация |
| **Bakta** | Прокариоты | Ортология + HMM | Высокая точность, современные БД, учёт ортологии | Большой размер полной БД | Исследовательские проекты, клинические изоляты |
| **DFAST** | Прокариоты | BLAST/HMMER + курируемые БД | Качественные базы | Узкая экосистема | Пищевая/клиническая микробиология |
| **PGAP (NCBI)** | Прокариоты | Правила + RefSeq | Эталон для публикаций, строгая номенклатура | Сложный запуск, долгое выполнение | Публикации, депонирование в GenBank |
| **Augustus** | Эукариоты | *Ab initio* | Лучший standalone предсказатель генов | Требует training set, нет функц. аннотации | В составе комплексных пайплайнов |
| **GeneMark-ET/ES** | Эукариоты | *Ab initio* с самообучением | Автономность, базовый уровень | Требует RNA-seq для лучшей точности | Первичное предсказание генов |
| **MAKER** | Эукариоты | Интеграция всех типов данных | Стандарт *de facto*, гибкий | Сложная настройка, ресурсоёмкий | Аннотация новых сложных геномов |
| **BRAKER2/3** | Эукариоты | Автоматическое обучение на RNA-seq | Автоматизация, высокое качество сплайсинга | Качество зависит от RNA-seq | Аннотация без референсного генома |
| **Funannotate** | Эукариоты (грибы) | Интеграция (Augustus, PASA, InterPro) | Полный комплекс (структ.+функц.) | Ограничен для больших геномов | Геномика грибов |

**Примечание:** Bakta в настоящее время является одним из наиболее популярных инструментов для прокариот благодаря балансу точности и скорости. PGAP считается эталоном для публикаций.

## Контроль качества аннотации

**Количественные и качественные метрики:** 

1. **Количество предсказанных генов:** отклонение от ожидаемого для вида может указывать на проблемы со сборкой (разрывы, контаминация) или аннотацией. 
2. **Доля гипотетических белков:** для бактерий типично 20-40%. Высокий процент может означать слабую функциональную аннотацию или новый, нехарактерный геном. 
3. **Корректность CDS:** правильные старт/стоп кодоны, отсутствие сдвигов рамки и нереалистичных перекрытий. 
4. **Наличие ключевых элементов:** полный набор тРНК, ожидаемое число копий рРНК (для прокариот — часто несколько копий 16S рРНК).
5. **Подтверждение данными:** для эукариот — поддержка границ интронов/экзонов данными RNA-seq.
6. **Согласованность:** совпадение результатов разных методов аннотации (BLAST, HMMER, eggNOG).

## Типичные ошибки при аннотации

**Для прокариот:** 

1. Разделение одной ORF на два псевдогена.
2.  Принятие коротких псевдогенов за настоящие гены (исправляется порогом по длине). 
3.  Пропуск генов в областях с атипичным GC-составом (например, у термофилов). 
4.  Ложная аннотация по вирулентности/резистентности из-за низкого покрытия плазмид.

**Для эукариот:** 1. Неправильное определение границ интронов/экзонов (без данных RNA-seq). 2. Переаннотация — предсказание ложных изоформ. 3. Аннотация повторов как генов.

## Инструменты контроля качества

-   **BUSCO** — оценка полноты аннотации на основе универсальных ортологичных генов.
-   **QUAST** — оценка качества сборки, влияющей на аннотацию.
-   **Artemis / IGV / JBrowse** — визуальная проверка аннотаций и выравниваний (RNA-seq).
-   **tbl2asn / NCBI Validator** — проверка формата и корректности перед загрузкой в GenBank.


# Практическая работа:  аннотация бактериального генома

## Цель работы
Освоение методов полной и специализированной функциональной аннотации бактериальных геномов с использованием инструментов **Bakta** и **Abricate**.

::: {.callout-warning}
## Ограничения Abricate
- Определяет только известные гены резистентности
- Не обнаруживает резистентность, вызванную точковыми мутациями

Для комплексного анализа резистентности рекомендуется использовать **RGI** (Resistance Gene Identifier), который учитывает различные механизмы устойчивости. 
:::


## Подготовка рабочего пространства

Создаем директории для данных, результатов и баз данных:

```{bash}
#| eval: false

# Основные директории
mkdir -p Структуры_данных/10.12.25/genome_annot_prac
cd Структуры_данных/10.12.25/genome_annot_prac

# Организационная структура
mkdir -p data results db
mkdir -p db/{bakta,abricate}
mkdir -p results/{bakta,abricate}

# Возврат в исходную директорию
cd -
```



## Установка необходимых инструментов

Устанавливаем пакеты через менеджер `mamba`:

```{bash}
#| eval: false
mamba install -y bakta abricate
```


## Подготовка данных

### Загрузка тестового генома

```{bash}
#| eval: false
cd Структуры_данных/10.12.25/genome_annot_prac/data

# Загрузка генома Staphylococcus aureus из NCBI
wget https://ftp.ncbi.nlm.nih.gov/genomes/all/GCF/000/013/425/GCF_000013425.1_ASM1342v1/GCF_000013425.1_ASM1342v1_genomic.fna.gz
gunzip GCF_000013425.1_ASM1342v1_genomic.fna.gz

cd -
```

### Загрузка баз данных

**Для Bakta:**
```{bash}
#| eval: false
cd Структуры_данных/10.12.25/genome_annot_prac/db/bakta
bakta_db download --output db-light --type light
cd -
```

**Для Abricate:**
```{bash}
#| eval: false
cd Структуры_данных/10.12.25/genome_annot_prac/db/abricate

# Базы генов устойчивости и факторов вирулентности
abricate-get_db --db card --force
abricate-get_db --db vfdb --force

# Создание индексов
abricate --setupdb

cd -
```


## Обзор содержимого баз данных

### База Bakta
```{bash}
ls Структуры_данных/10.12.25/genome_annot_prac/db/bakta/db-light/db-light
```


### Базы Abricate
```{bash}
abricate --list | column -s $'\t' -t
```

Доступные базы:

- `card` — гены антибиотикорезистентности
- `vfdb` — факторы вирулентности
- `plasmidfinder` — плазмидные репликоны
- `ncbi` — база NCBI и др.




## Полная аннотация генома с помощью Bakta

### Подготовка и запуск
```{bash}
#| eval: false
# Очистка предыдущих результатов (если необходимо)
rm -rf Структуры_данных/10.12.25/genome_annot_prac/results/bakta/test_genome/*

# Определение переменных
GENOME=Структуры_данных/10.12.25/genome_annot_prac/data/GCF_000013425.1_ASM1342v1_genomic.fna
BAKTA_DB=Структуры_данных/10.12.25/genome_annot_prac/db/bakta/db-light/db-light
OUTPUT_DIR=Структуры_данных/10.12.25/genome_annot_prac/results/bakta/test_genome

# Запуск аннотации
bakta --db $BAKTA_DB \
      --output $OUTPUT_DIR \
      --prefix test_genome \
      $GENOME
```


### Форматы выходных файлов Bakta

[Bakta](https://bakta.readthedocs.io/en/latest/cli/inputoutput.html) предоставляет результаты аннотации в стандартных биоинформатических форматах:

- **`<префикс>.tsv`**: аннотации в удобочитаемом формате TSV
- **`<префикс>.gff3`**: аннотации и последовательности в формате GFF3
- **`<префикс>.gbff`**: аннотации и последовательности в формате GenBank (многофайловый)
- **`<префикс>.embl`**: аннотации и последовательности в формате EMBL
- **`<префикс>.fna`**: последовательности репликонов/контигов в формате FASTA
- **`<префикс>.ffn`**: нуклеотидные последовательности всех аннотированных элементов генома в формате FASTA
- **`<префикс>.faa`**: аминокислотные последовательности CDS/sORF в формате FASTA
- **`<префикс>.inference.tsv`**: Метрики выравнивания (score, e-value, покрытие, идентичность) для референтных последовательностей, использованных при аннотации, в формате TSV
- **`<префикс>.hypotheticals.tsv`**: дополнительная информация о гипотетических белках в TSV
- **`<префикс>.hypotheticals.faa`**: аминокислотные последовательности гипотетических белков в FASTA
- **`<префикс>.txt`**: сводная статистика в TXT
- **`<префикс>.png`**: круговая диаграмма аннотации генома в PNG
- **`<префикс>.svg`**: круговая диаграмма аннотации генома в SVG
- **`<префикс>.json`**: вся (внутренняя) информация об аннотациях и последовательностях в JSON

**Общая статистика:**
```{bash}
cat Структуры_данных/10.12.25/genome_annot_prac/results/bakta/test_genome/test_genome.txt
```

**Полная аннотация:**
```{bash}
head -10 Структуры_данных/10.12.25/genome_annot_prac/results/bakta/test_genome/test_genome.tsv |\
column -s $'\t' -t
```

**Визуализация:**
![Карта генома: CDS, tRNA, rRNA, ncRNA, CRISPR, GC-состав и ориджин репликации](Структуры_данных/10.12.25/genome_annot_prac/results/bakta/test_genome/test_genome.png)



## Специализированная аннотация с помощью Abricate

### Поиск генов устойчивости (CARD) и факторов вирулентности (VFDB)
```{bash}
GENOME=Структуры_данных/10.12.25/genome_annot_prac/data/GCF_000013425.1_ASM1342v1_genomic.fna

abricate --db card $GENOME > \
Структуры_данных/10.12.25/genome_annot_prac/results/abricate/test_genome.card.tab

abricate --db vfdb $GENOME > \
Структуры_данных/10.12.25/genome_annot_prac/results/abricate/test_genome.vfdb.tab
```

### Результаты

#### Факторы вирулентности:
```{bash}
head -10 Структуры_данных/10.12.25/genome_annot_prac/results/abricate/test_genome.vfdb.tab |\
column -s $'\t' -t
```


#### Гены антибиотикорезистентности:
```{bash}
cat Структуры_данных/10.12.25/genome_annot_prac/results/abricate/test_genome.card.tab |\
column -s $'\t' -t
```






